# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags (1)",
"Bags (2)",
"Bags (3)",
"Bags (4)",
"Bags (5)"),
Original = NA_real_, Theta = NA_real_, Attrition = NA_real_)
# bags ----------
t5_reg <- lm(pf ~ treat + factor(pair), data = bags[after==1][a16_1_gradeA==1])
t5_reg$coefficients[2]
cr_attr_est[1, 2:3] <- list(as.numeric(t5_reg$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[after==1][a16_1_gradeA==1])$coefficients[2]))
cr_attr_est[1, 4] <- list(100 - 100 * length(unique(bags[after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80)
View(cr_attr_est)
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
print(length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)))
View(cr_attr_est)
View(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==TRUE])
View(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
table(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)
bags$sid
bags$sid %>% unique %>% length
unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid) %>% length
bags[week==w][after==1][a16_1_gradeA==1]
bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
print(length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==TRUE])))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
print(length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==TRUE])))
bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==TRUE]
bags[is.na(pdf)]
bags[is.na(pf)]
print(length(unique(bags[week==w][after==1][a16_1_gradeA==1]$pair)))
bags$pair %>% table
bags$pair %>% unique %>% length
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
}
w=2703
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]
res_w <- list()
results <- list()
res_w <- list()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
j <- j + 1
}
View(results)
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
j <- j + 1
}
mean(res_w)
mean(res_w, na.rm=TRUE)
1960+floor(2703/52)
2703%%52
res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
mean(res_w)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
mean(res_w)
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
# print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
# print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
print(paste("averaged attrition across all weeks is", mean(res_w)))
w=2701
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
weeks
2703 %% 52
print(paste("averaged attrition across all weeks is", mean(res_w), "%"))
print(paste("attrition is", list(100 - 100 * length(unique(bags[after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
# print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
print(paste("averaged attrition across all weeks is", mean(res_w), "%"))
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
# print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
print(paste("week", w, ":", "attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
print(paste("averaged attrition across all weeks is", mean(res_w), "%"))
###############################
# date: 9/1/2022
# Groh & McKenzie application
###############################
rm(list = ls())
cat("\014")
options(scipen=999)
# install.packages("pacman") # uncomment if needed
# set seed for pilot
set.seed(3333)
pacman::p_load(ramify, fastDummies, doParallel, foreach, data.table, nbpMatching, sandwich, lmtest, haven, tidyverse, xtable)
registerDoParallel(cores = 36)
getDoParWorkers()
getDoParName()
# working directory
setwd("/Users/rexhsieh/Dropbox (University of Michigan)/Attrition RCT - Applications/2. Casaburi & Reed (2021)")
# data
bags <- as.data.table(read_dta("R2/dta/data_for_analysis/data_bags_cleaned_210630.dta"))
# credit <- as.data.table(read_dta("R2/dta/data_for_analysis/data_credit_cleaned_210630.dta"))
# quantity <- as.data.table(read_dta("R2/dta/data_for_analysis/data_quantity_weekly_cleaned_210630.dta"))
# df = gm_cleaned; Y = "admin_loanrenewal"; D = "treat"; A = "attrition"; G = "pair"   ##debug
# reg pf treat i.pair
# table
cr_attr_est <- data.table(reg = c("Bags",
"Credit",
"Quantity"),
orig_est = NA_real_, theta_n = NA_real_, attrition = NA_real_)
weeks <- unique(bags[after==1][a16_1_gradeA==1]$week)
# (1) ----------
results <- list()
res_w <- c()
j <- 1
for (w in weeks) {
results[[w]] <- list(as.numeric(lm(pf ~ treat + factor(pair), data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]),
as.numeric(lm(pf ~ treat, data = bags[week==w][after==1][a16_1_gradeA==1])$coefficients[2]))
# print(paste("week", w, ": ", nrow(bags[week==w][after==1][a16_1_gradeA==1])))
# print(nrow(bags[week==w][after==1][a16_1_gradeA==1]) / nrow(bags[after==1][a16_1_gradeA==1]))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$pair)) / 40), "percent"))
# print(paste("attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
res_w[j] <- 100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80
print(paste("week", w, ":", "attrition is", list(100 - 100 * length(unique(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE]$sid)) / 80), "percent"))
# res_w[j] <- nrow(bags[week==w][after==1][a16_1_gradeA==1][is.na(pf)==FALSE])
j <- j + 1
}
print(paste("averaged attrition across all weeks is", mean(res_w), "percent"))
